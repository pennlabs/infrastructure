version: 3
projects:
  - name: chronos
    dir: terraform/chronos
    autoplan:
      when_modified: ["*.tf", "helm/*.yaml", "../modules/**/*.tf"]
  - name: base
    dir: terraform/base
    autoplan:
      when_modified:
        - "*.tf"
        - helm-sandbox/*.yaml"
        - helm-production/*.yaml"
        - "../modules/**/*.tf"
    workflow: base
  - name: vault
    dir: terraform/vault
    autoplan:
      when_modified: ["*.tf", "policies/*.hcl"]

workflows:
  base:
    plan:
      steps:
        - run: terraform refresh ../chronos
        - plan
